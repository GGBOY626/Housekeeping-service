{"version":3,"file":"index.js","sources":["subPages/history/index.vue","../../../../develop/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFnZXNcaGlzdG9yeVxpbmRleC52dWU"],"sourcesContent":["<!-- ；历史订单页面 -->\r\n<template>\r\n  <scroll-view class=\"scroll-view-content\" scroll-y>\r\n    <view class=\"historyOrder pageCon appList itemListBox orderBox\">\r\n      <!-- 订单列表 -->\r\n      <NavBar\r\n        title=\"历史订单\"\r\n        :isShowBack=\"true\"\r\n        :handleToLink=\"handleToLink\"\r\n        :isHistory=\"true\"\r\n        :historyTime=\"true\"\r\n        @handletTime=\"handletTime\"\r\n      ></NavBar>\r\n      <HomeList\r\n        v-if=\"homeList.data.length\"\r\n        :itemData=\"homeList.data\"\r\n        :loading=\"loading\"\r\n        :moreStatus=\"moreStatus\"\r\n        :history=\"true\"\r\n        @handleDelete=\"handleDelete\"\r\n        @onReachBottom=\"onReachBottom\"\r\n      ></HomeList>\r\n      <view v-else class=\"empty-box\">\r\n        <image src=\"../../static/zwnr@2x.png\"></image>\r\n        <view>暂无历史订单哦～</view>\r\n      </view>\r\n      <!-- 历史筛选弹窗，起始时间 -->\r\n      <gscosmosDateSelect\r\n        :date=\"startTime\"\r\n        :minYear=\"1900\"\r\n        :maxYear=\"2100\"\r\n        timeType=\"start\"\r\n        :defaultValue=\"[\r\n          new Date(startTime).getFullYear() - 1900,\r\n          new Date(startTime).getMonth(),\r\n          new Date(startTime).getDate() - 1,\r\n        ]\"\r\n        @confirm=\"bindStartDateChange\"\r\n        ref=\"gscosmosDateSelect\"\r\n        :showCalendar=\"dateSelecStarttVisiable\"\r\n        @cancel=\"close\"\r\n      ></gscosmosDateSelect>\r\n      <!-- 历史筛选弹窗，结束弹窗 -->\r\n      <gscosmosDateSelect\r\n        :date=\"endTime\"\r\n        :minYear=\"1900\"\r\n        :maxYear=\"2100\"\r\n        timeType=\"end\"\r\n        :defaultValue=\"[\r\n          new Date(endTime).getFullYear() - 1900,\r\n          new Date(endTime).getMonth(),\r\n          new Date(endTime).getDate() - 1,\r\n        ]\"\r\n        @confirm=\"bindEndDateChange\"\r\n        ref=\"gscosmosDateSelect\"\r\n        :showCalendar=\"dateSelecEndtVisiable\"\r\n        @cancel=\"close\"\r\n      ></gscosmosDateSelect>\r\n      <!-- 普通弹窗 -->\r\n      <uni-popup ref=\"popup\" background-color=\"#fff\" type=\"bottom\">\r\n        <view class=\"popup-content\">\r\n          <view class=\"header\">\r\n            <view class=\"tips\">选择时间</view>\r\n            <image class=\"close\" src=\"../../static/new/btn_nav_close@2x.png\" />\r\n          </view>\r\n          <view class=\"time\">\r\n            <view class=\"startTime\" @click=\"handleStartTime\">{{\r\n              startTime || '开始时间'\r\n            }}</view>\r\n            <view class=\"zhi\">至</view\r\n            ><view class=\"endTime\" @click=\"handleEndTime\">{{\r\n              endTime || '结束时间'\r\n            }}</view>\r\n          </view>\r\n          <view class=\"footer\">\r\n            <view class=\"btn-grey\" @click=\"handleReset\">重置</view>\r\n            <view class=\"agree-btn btn\" @click=\"searchDataByTime\">确定</view>\r\n          </view>\r\n        </view>\r\n      </uni-popup>\r\n    </view>\r\n  </scroll-view>\r\n  <!-- end -->\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue';\r\nimport { onShow } from '@dcloudio/uni-app';\r\nimport { formatDateTimeToDateString } from '@/utils/index.js';\r\n\r\n//接口\r\nimport { getHistoryOrder } from '@/pages/api/order.js';\r\n\r\n//订单列表\r\nimport HomeList from '../order/components/list.vue';\r\n// 日期选择\r\nimport gscosmosDateSelect from '../../components/gscosmosDateSelect';\r\n// ------定义变量------\r\nconst moreStatus = ref('more'); //加载更多状态 loading  more noMore\r\nconst emit = defineEmits(''); //子组件向父组件事件传递\r\nconst popup = ref(''); //弹窗\r\nconst loading = ref(false); // 是否展示加载更多\r\nconst isSendRequest = ref(false); // 是否继续发送请求\r\nconst dateSelecStarttVisiable = ref(false);\r\nconst dateSelecEndtVisiable = ref(false);\r\nconst pages = ref(0); // 单页条数\r\nconst homeList = reactive({\r\n  data: [],\r\n});\r\nconst netStatus = ref(true);\r\nconst startTime = ref(\r\n  formatDateTimeToDateString(\r\n    new Date(new Date(new Date()).setDate(new Date().getDate() - 181))\r\n  )\r\n); // 默认开始时间\r\nconst endTime = ref(\r\n  formatDateTimeToDateString(\r\n    new Date(new Date(new Date()).setDate(new Date().getDate() - 1))\r\n  )\r\n); // 默认结束时间\r\n\r\nconst scrollTop = ref(0);\r\nconst scrollView = ref(null);\r\n// ------生命周期------\r\nonShow(() => {\r\n  homeList.data = [];\r\n  isSendRequest.value = false; // 是否继续发送请求\r\n  getNewData();\r\n});\r\n//重置时间\r\nconst handleReset = () => {\r\n  startTime.value = '开始时间';\r\n  endTime.value = '结束时间';\r\n};\r\n//按照起始时间查询数据\r\nconst searchDataByTime = () => {\r\n  if (startTime.value === '开始时间' || endTime.value === '结束时间') {\r\n    return uni.showToast({\r\n      title: '请选择时间',\r\n      duration: 1000,\r\n      icon: 'none',\r\n    });\r\n  } else if (\r\n    new Date(endTime.value).getTime() - new Date(startTime.value).getTime() <\r\n    0\r\n  ) {\r\n    return uni.showToast({\r\n      title: '开始时间不可大于结束时间',\r\n      duration: 1000,\r\n      icon: 'none',\r\n    });\r\n  }\r\n  homeList.data = [];\r\n  isSendRequest.value = false;\r\n  getNewData();\r\n  popup.value.close();\r\n};\r\n// 打开开始时间弹窗\r\nconst handleStartTime = () => {\r\n  dateSelecStarttVisiable.value = true;\r\n};\r\n// 打开结束时间弹窗\r\nconst handleEndTime = () => {\r\n  dateSelecEndtVisiable.value = true;\r\n};\r\n//开始时间\r\nconst bindStartDateChange = (e) => {\r\n  if (\r\n    new Date(endTime.value).getTime() -\r\n      new Date(formatDateTimeToDateString(new Date(e.solarDate))).getTime() >\r\n    31536000000\r\n  ) {\r\n    uni.showToast({\r\n      title: '时间间隔不能大于365天',\r\n      duration: 1000,\r\n      icon: 'none',\r\n    });\r\n  } else {\r\n    startTime.value = formatDateTimeToDateString(new Date(e.solarDate));\r\n    close();\r\n  }\r\n};\r\n//结束时间\r\nconst bindEndDateChange = (e) => {\r\n  if (\r\n    new Date(formatDateTimeToDateString(new Date(e.solarDate))).getTime() -\r\n      new Date(startTime.value).getTime() >\r\n    31536000000\r\n  ) {\r\n    return uni.showToast({\r\n      title: '时间间隔不能大于365天',\r\n      duration: 1000,\r\n      icon: 'none',\r\n    });\r\n  } else {\r\n    endTime.value = formatDateTimeToDateString(new Date(e.solarDate));\r\n    close();\r\n  }\r\n};\r\n// 关闭弹窗\r\nconst close = () => {\r\n  dateSelecStarttVisiable.value = false;\r\n  dateSelecEndtVisiable.value = false;\r\n};\r\n//  打开筛选弹窗\r\nconst handletTime = () => {\r\n  popup.value.open();\r\n};\r\n// 上拉更多数据\r\nconst onReachBottom = () => {\r\n  if (pages.value < 10) {\r\n    moreStatus.value = 'noMore';\r\n    return false;\r\n  } else {\r\n    moreStatus.value = 'loading';\r\n    setTimeout(() => {\r\n      getNewData(homeList.data[homeList.data.length - 1].sortTime);\r\n    }, 1000); //这里延时一秒在加载方法有个loading效果\r\n  }\r\n};\r\n// 获取数据\r\nconst getNewData = async (time) => {\r\n  const params = {\r\n    minSortTime: startTime.value + ' 00:00:00',\r\n    maxSortTime: endTime.value + ' 23:59:59',\r\n  };\r\n  if (time) {\r\n    params.lastSortTime = time;\r\n  }\r\n  if (isSendRequest.value) {\r\n    return;\r\n  }\r\n  moreStatus.value = 'loading';\r\n  loading.value = false;\r\n  await getHistoryOrder(params)\r\n    .then((res) => {\r\n      if (res.data.code == 200) {\r\n        const { data } = res.data;\r\n        // items == null 会报错 把他处理掉\r\n        const items = data == null ? [] : data;\r\n        moreStatus.value = items.length < 10 ? 'no-more' : 'more';\r\n        // 从第一页请求 清空之前的数据\r\n        // 下拉数据合并\r\n        homeList.data = homeList.data ? [...homeList.data, ...items] : items;\r\n        // 如果 当前页面的数据已经全部数据了 那么停止拿数据\r\n        pages.value = data.length;\r\n        if (pages.value < 10) {\r\n          isSendRequest.value = true;\r\n          moreStatus.value = 'noMore';\r\n        }\r\n        uni.stopPullDownRefresh();\r\n        netStatus.value = true;\r\n        loading.value = true;\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      // 弹出错误提示\r\n      console.log(err);\r\n    });\r\n};\r\n</script>\r\n<style src=\"../../styles/expressage.scss\" lang=\"scss\" scoped></style>\r\n<style src=\"../../styles/common.scss\" lang=\"scss\" scoped></style>\r\n<style src=\"./index.scss\" lang=\"scss\" scoped></style>\r\n<style src=\"../order/index.scss\" lang=\"scss\" scoped></style>\r\n<style lang=\"scss\" scoped>\r\n.scroll-view-content {\r\n  height: calc(100% - 81px); /* 主内容区域的高度减去底部栏的高度 */\r\n  padding-top: 175rpx; /* 底部栏的高度，确保内容不被底部栏遮挡 */\r\n  :deep(.NavBar) {\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 0;\r\n    width: 100%;\r\n    z-index: 999;\r\n  }\r\n  :deep(.itemTab .tabBox) {\r\n    box-sizing: border-box;\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 166rpx;\r\n    width: 100%;\r\n    z-index: 999;\r\n    font-size: 28rpx;\r\n  }\r\n}\r\n.itemListBox {\r\n  :deep(.timeList) {\r\n    .item {\r\n      padding: 35rpx 32rpx 19rpx 28rpx;\r\n    }\r\n    .itemCon {\r\n      .rText {\r\n        .info {\r\n          padding-bottom: 8rpx;\r\n        }\r\n        .tit {\r\n          padding-bottom: 15rpx;\r\n          margin-top: -8rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n.btn-grey {\r\n  width: 250rpx;\r\n  height: 88rpx;\r\n  background: #ebebeb;\r\n  margin-right: 32rpx;\r\n  border-radius: 44rpx;\r\n  line-height: 88rpx;\r\n  text-align: center;\r\n}\r\n.agree-btn {\r\n  width: 408rpx;\r\n  height: 88rpx;\r\n  background: #f74346;\r\n  border-radius: 50rpx;\r\n  text-align: center;\r\n}\r\n.empty-box {\r\n  padding-top: 300rpx;\r\n  height: 71vh;\r\n  background-color: #fff;\r\n  image {\r\n    width: 320rpx;\r\n    height: 288rpx;\r\n    display: block;\r\n    margin: 0 auto;\r\n  }\r\n  view {\r\n    font-size: 26rpx;\r\n    line-height: 36rpx;\r\n    margin-top: 43rpx;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/class_project/jzo2o/jzo2o-front/jzo2o-consumer/subPages/history/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","formatDateTimeToDateString","onShow","uni","getHistoryOrder"],"mappings":"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"}