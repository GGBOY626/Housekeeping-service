{"version":3,"file":"index.js","sources":["subPages/order/index.vue","../../../../develop/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFnZXNcb3JkZXJcaW5kZXgudnVl"],"sourcesContent":["<!--订单列表-->\r\n<template>\r\n  <scroll-view class=\"scroll-view-content\" scroll-y>\r\n    <view class=\"pageCon appList itemListBox orderBox\">\r\n      <!-- 标题 -->\r\n      <NavBar\r\n        title=\"我的订单\"\r\n        :isShowBack=\"true\"\r\n        :handleToLink=\"handleToLink\"\r\n        :isHistory=\"true\"\r\n        :historyTime=\"false\"\r\n      ></NavBar>\r\n      <!-- end -->\r\n      <view v-if=\"netStatus\">\r\n        <List\r\n          :itemData=\"itemData\"\r\n          @setTabIndex=\"setTabIndex\"\r\n          :moreStatus=\"moreStatus\"\r\n          :loading=\"loading\"\r\n          @handleDelete=\"handleDelete\"\r\n          @onReachBottom=\"onReachBottom\"\r\n        ></List>\r\n      </view>\r\n      <!-- 断网显示的页面 -->\r\n      <net-fail v-else :handleToRefresh=\"handleToRefresh\"></net-fail>\r\n      <!-- 删除弹层 -->\r\n      <DeletePopup\r\n        ref=\"deleteRef\"\r\n        @handleSub=\"subDelete\"\r\n        :errorTipText=\"errorTipText\"\r\n      ></DeletePopup>\r\n      <!-- end -->\r\n    </view>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue';\r\nimport { onShow, onLoad, onUnload } from '@dcloudio/uni-app';\r\nimport { useStore } from 'vuex';\r\n// 接口\r\nimport { getOrderScroll } from '@/pages/api/order.js';\r\n// 组件\r\n// 取消弹层\r\nimport DeletePopup from '@/components/Operate/index.vue';\r\n// 列表\r\nimport List from './components/list.vue';\r\n// ------定义变量------\r\nconst store = useStore(); //存储获取数据\r\nconst users = store.state.user; //获取存储数据\r\nconst typeVal = ref(users.backLink);\r\nconst deleteRef = ref(null); //定义取消弹层ref\r\nconst itemData = ref([]); //预约数据\r\nconst moreStatus = ref('more'); //加载更多状态 loading  more noMore\r\nconst netStatus = ref(true);\r\nconst loading = ref(false); // 是否展示加载更多\r\nconst orderId = ref(); //预约id\r\nconst errorTipText = ref({\r\n  title: '',\r\n  text: '您确定要删除订单么？',\r\n}); //取消弹层显示的内容\r\nlet params = reactive({\r\n  sortBy:'',\r\n  ordersStatus: '',\r\n});\r\nconst pages = ref(0); // 单页条数\r\nconst isSendRequest = ref(false); // 是否继续发送请求\r\nconst isback = ref(false); //是否触发了左上角返回按钮\r\n// ------定义方法------\r\nonLoad((options) => {\r\n  if (options.str) {\r\n    typeVal.value = options.str;\r\n    store.commit('user/setOrderType', false);\r\n  }\r\n  typeVal.value = users.backLink;\r\n  store.commit('user/setOrderType', false);\r\n});\r\nonUnload(() => {\r\n  const val = users.backLink;\r\n  store.commit('setFootStatus', 0);\r\n  if (!isback.value) {\r\n    if (val === 'home') {\r\n      uni.reLaunch({\r\n        url: `/pages/index/index`,\r\n      });\r\n      store.commit('setFootStatus', 0);\r\n    }\r\n    store.commit('user/setOrderStatus', ''); //清除订单的当前状态\r\n  }\r\n});\r\nonShow(() => {\r\n  params.ordersStatus =\r\n    users.orderStatus === '' || users.orderStatus === 7\r\n      ? ''\r\n      : users.orderStatus;\r\n  params.sortBy = '';\r\n  isSendRequest.value = false;\r\n  itemData.value = [];\r\n  getNewData();\r\n});\r\n// 获取任务列表\r\nconst getNewData = async (type) => {\r\n  params = {\r\n    ...params,\r\n  };\r\n  params.sortBy = itemData.value[itemData.value.length - 1]?.sortBy ? itemData.value[itemData.value.length - 1]?.sortBy : '';\r\n  if (isSendRequest.value) {\r\n    return;\r\n  }\r\n  moreStatus.value = 'loading';\r\n  loading.value = false;\r\n  await getOrderScroll(params)\r\n    .then((res) => {\r\n      if (res.data.code == 200) {\r\n        const { data } = res.data;\r\n        // items == null 会报错 把他处理掉\r\n        const items = data == null ? [] : data;\r\n        moreStatus.value = items.length < 10 ? 'no-more' : 'more';\r\n        // 从第一页请求 清空之前的数据\r\n        // 下拉数据合并\r\n        itemData.value = itemData.value ? [...itemData.value, ...items] : items;\r\n        // 如果 当前页面的数据已经全部数据了 那么停止拿数据\r\n        pages.value = data.length;\r\n        if (pages.value < 10) {\r\n          isSendRequest.value = true;\r\n          moreStatus.value = 'noMore';\r\n        }\r\n        uni.stopPullDownRefresh();\r\n        netStatus.value = true;\r\n        loading.value = true;\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      // 弹出错误提示\r\n      console.log(err);\r\n      uni.showToast({\r\n        title: err,\r\n        duration: 1000,\r\n        icon: 'none',\r\n      });\r\n      netStatus.value = false;\r\n    });\r\n};\r\n\r\n// 确认删除\r\nconst subDelete = async () => {\r\n  isSendRequest.value = false;\r\n  await orderDelete(orderId.value)\r\n    .then((res) => {\r\n      if (res.code === 200) {\r\n        itemData.value = [];\r\n        getNewData();\r\n        deleteRef.value.popup.close();\r\n        uni.showToast({\r\n          title: '删除成功',\r\n          duration: 1000,\r\n          icon: 'none',\r\n        });\r\n      }\r\n    })\r\n    .catch((err) => {});\r\n};\r\n// tab触发切换\r\nconst setTabIndex = (index) => {\r\n  store.commit('user/setOrderStatus', index);\r\n  params.ordersStatus = index;\r\n  params.sortBy = '';\r\n  isSendRequest.value = false;\r\n  if (index === 7) {\r\n    params.ordersStatus = '';\r\n  }\r\n  itemData.value = [];\r\n  getNewData();\r\n};\r\n// 上拉更多数据\r\nconst onReachBottom = () => {\r\n  if (pages.value < 10) {\r\n    moreStatus.value = 'noMore';\r\n    return false;\r\n  } else {\r\n    moreStatus.value = 'loading';\r\n    let times = setTimeout(() => {\r\n      getNewData();\r\n    }, 1000); //这里延时一秒在加载方法有个loading效果\r\n  }\r\n};\r\n//删除\r\nconst handleDelete = (id) => {\r\n  orderId.value = id;\r\n  deleteRef.value.popup.open();\r\n};\r\n// 列表页返回\r\nconst handleToLink = () => {\r\n  // 返回的时候需要把订单列表页的当前状态设置为0\r\n  store.commit('user/setOrderStatus', '');\r\n  // 如果是从首页进来的绑定页面，返回到首页，否则返回到绑定列表页\r\n  isback.value = true; //是否触发了左上角返回按钮\r\n\r\n  if (typeVal.value === 'my' || typeVal.value === 'pay') {\r\n    store.commit('setFootStatus', 3);\r\n    // uni.navigateBack();\r\n    uni.redirectTo({\r\n      url: '/pages/my/index',\r\n    });\r\n  } else {\r\n    store.commit('setFootStatus', 0);\r\n    uni.reLaunch({\r\n      url: `/pages/index/index`,\r\n    });\r\n  }\r\n};\r\nconst handleToRefresh = () => {\r\n  getNewData();\r\n};\r\n</script>\r\n<style src=\"./index.scss\" lang=\"scss\" scoped></style>\r\n<style lang=\"scss\" scoped>\r\n.scroll-view-content {\r\n  height: calc(100% - 162rpx); /* 主内容区域的高度减去底部栏的高度 */\r\n  padding-top: 259rpx; /* 底部栏的高度，确保内容不被底部栏遮挡 */\r\n  :deep(.NavBar) {\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 0;\r\n    width: 100%;\r\n    z-index: 999;\r\n  }\r\n  :deep(.itemTab .tabBox) {\r\n    box-sizing: border-box;\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 166rpx;\r\n    width: 100%;\r\n    z-index: 999;\r\n    font-size: 28rpx;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/class_project/jzo2o/jzo2o-front/jzo2o-consumer/subPages/order/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStore","ref","reactive","onLoad","onUnload","uni","onShow","getOrderScroll"],"mappings":"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"}