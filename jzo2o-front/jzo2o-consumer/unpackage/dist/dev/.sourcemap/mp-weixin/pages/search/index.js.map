{"version":3,"file":"index.js","sources":["pages/search/index.vue","../../../../develop/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL2luZGV4LnZ1ZQ"],"sourcesContent":["<!--订单搜索-->\r\n<template>\r\n  <view class=\"pageCon appBox searchBase\">\r\n    <!-- 标题 -->\r\n    <NavBar\r\n      title=\"搜索\"\r\n      :isShowBack=\"true\"\r\n      :handleToLink=\"handleToLink\"\r\n    ></NavBar>\r\n    <!-- end -->\r\n    <view class=\"main\" v-if=\"netStatus\">\r\n      <!-- 搜索 -->\r\n      <view class=\"searchBox\">\r\n        <view class=\"input-view\">\r\n          <uni-icons class=\"input-uni-icon\" type=\"search\" size=\"18\" />\r\n          <input\r\n            confirm-type=\"search\"\r\n            class=\"nav-bar-input\"\r\n            type=\"text\"\r\n            v-model=\"searchData.keyword\"\r\n            placeholder=\"搜索\"\r\n            @confirm=\"handleSearch\"\r\n            @input=\"handleInput\"\r\n            @blur=\"handleBlur\"\r\n          />\r\n          <uni-icons\r\n            v-if=\"showClearIcon\"\r\n            class=\"input-uni-icon\"\r\n            type=\"clear\"\r\n            size=\"18\"\r\n            @click.stop=\"handleClear\"\r\n          />\r\n        </view>\r\n        <view class=\"font-col cancel\" @click.stop=\"handleList('cancel')\"\r\n          >取消</view\r\n        >\r\n      </view>\r\n      <!-- end -->\r\n      <!-- 搜索出的列表 -->\r\n      <List\r\n        :itemData=\"itemData\"\r\n        :moreStatus=\"moreStatus\"\r\n        :loading=\"loading\"\r\n        @handleClear=\"handleClear\"\r\n        @onReachBottom=\"onReachBottom\"\r\n        @handleList=\"handleList\"\r\n        @handleBlur=\"handleBlur\"\r\n        :isHistory=\"isHistory\"\r\n      ></List>\r\n      <!-- end -->\r\n      <!-- 历史记录 -->\r\n      <view\r\n        class=\"historyBox\"\r\n        v-if=\"\r\n          itemData.length === 0 && searchHistoryData.length > 0 && !isHistory\r\n        \"\r\n      >\r\n        <view class=\"tit\">\r\n          <view>历史记录</view\r\n          ><uni-icons class=\"input-uni-delect\" @click=\"clearHistory\" />\r\n        </view>\r\n        <view class=\"item\"\r\n          ><text\r\n            v-for=\"(item, index) in searchHistoryData\"\r\n            :key=\"index\"\r\n            @click.stop=\"handleList(item)\"\r\n            >{{ item }}</text\r\n          ></view\r\n        >\r\n      </view>\r\n      <!-- end -->\r\n    </view>\r\n\r\n    <!-- 断网显示的页面 -->\r\n    <net-fail v-else :handleToRefresh=\"handleToRefresh\"></net-fail>\r\n    <!-- end -->\r\n    <!-- 删除历史里路操作提示 -->\r\n    <DeletePopup\r\n      ref=\"deleteRef\"\r\n      @handleSub=\"subDelete\"\r\n      :errorTipText=\"errorTipText\"\r\n    ></DeletePopup>\r\n    <!-- end -->\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { onLoad, onShow } from '@dcloudio/uni-app';\r\n// 接口\r\nimport { getServeSearch } from '@/pages/api/index.js';\r\n// 列表\r\nimport List from './components/List.vue';\r\n// 删除历史记录确认框组件\r\nimport DeletePopup from '@/components/Operate/index.vue';\r\n// ------定义变量------\r\nconst deleteRef = ref(null); //定义取消弹层ref\r\nconst itemData = ref([]); //列表数据\r\nconst moreStatus = ref('more'); //加载更多状态 loading  more noMore\r\nconst netStatus = ref(true);\r\nconst isHistory = ref(false); //用来控制显示历史记录还是无数据\r\nconst loading = ref(false); // 是否展示加载更多\r\nconst searchData = ref({\r\n  cityCode: uni.getStorageSync('city').cityCode,\r\n  serveTypeId: '',\r\n  keyword: '',\r\n});\r\nlet pageNum = ref(1); //存放当前页\r\nconst pages = ref(0); // 总页数\r\n\r\nconst showClearIcon = ref(false); //是否显示清除图标\r\nlet capsuleBottom = ref();\r\nconst searchHistoryData = ref([]); //历史数据\r\nconst errorTipText = ref({\r\n  title: '',\r\n  text: '确定要全部清空吗？',\r\n}); //弹层显示的内容\r\n// ------定义方法------\r\n//胶囊底部距离头部的距离\r\nonLoad((option) => {\r\n  uni.getSystemInfo({\r\n    success: (res) => {\r\n      capsuleBottom.value = uni.getMenuButtonBoundingClientRect().bottom + 10;\r\n    },\r\n  });\r\n  if (option.name !== undefined && option.name !== '') {\r\n    searchData.value.keyword = option.name;\r\n    showClearIcon.value = true;\r\n    getNewData();\r\n  }\r\n});\r\n// ------定义方法------\r\nonShow((e) => {\r\n  searchHistoryData.value = uni.getStorageSync('historyData').slice(0, 10);\r\n});\r\n// 获取列表\r\nconst getNewData = async () => {\r\n  moreStatus.value = 'loading';\r\n  loading.value = false;\r\n  // 获取商品列表数据\r\n  await getServeSearch(searchData.value)\r\n    .then((res) => {\r\n      if (res.data.code == 200) {\r\n        const { data } = res.data;\r\n        // 下拉数据合并\r\n        itemData.value = data;\r\n        uni.stopPullDownRefresh();\r\n        netStatus.value = true;\r\n        loading.value = true;\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      uni.showToast({\r\n        title: err.msg,\r\n        duration: 1000,\r\n        icon: 'none',\r\n      });\r\n      netStatus.value = false;\r\n    });\r\n};\r\n// 搜索\r\nconst handleSearch = () => {\r\n  getNewData();\r\n  isHistory.value = true; //搜所时候不显示历史记录\r\n};\r\n// 离开搜索框触发\r\nconst handleBlur = (e) => {\r\n  // if (!isHistory.value) {\r\n  let text = searchData.value.keyword;\r\n  // 去除空格\r\n  text = text?.replace(/\\s*/g, '');\r\n  let arr = [];\r\n  if (text !== '') {\r\n    // 如果数组中包含字符串，有的话就删除之前的，把新搜索的放在数组前面\r\n    if (searchHistoryData.value.includes(text)) {\r\n      // 查找字符串在数组中出现的位置\r\n      let i = searchHistoryData.value.indexOf(text);\r\n      // 删除原来数据\r\n      searchHistoryData.value.splice(i, 1);\r\n    }\r\n    // 把新搜索的字符串添加到数组的前面\r\n    arr.unshift(text);\r\n    searchHistoryData.value = [...arr, ...searchHistoryData.value];\r\n    searchHistoryData.value = searchHistoryData.value.slice(0, 10);\r\n    // 存储数据到缓存\r\n    uni.setStorageSync('historyData', searchHistoryData.value);\r\n  }\r\n  // }\r\n};\r\n// 断网刷新\r\nconst handleToRefresh = () => {\r\n  searchData.value.pageNum = 1;\r\n  getNewData();\r\n};\r\n// 上拉更多数据\r\nconst onReachBottom = () => {\r\n  if (pageNum.value >= pages.value) {\r\n    moreStatus.value = 'noMore';\r\n    return false;\r\n  } else {\r\n    moreStatus.value = 'loading';\r\n    let times = setTimeout(() => {\r\n      pageNum.value++;\r\n      getNewData();\r\n    }, 1000); //这里延时一秒在加载方法有个loading效果\r\n  }\r\n};\r\n// 搜索框输入内容触发\r\nconst handleInput = (e) => {\r\n  // searchData.value.keyword = e.detail.value;\r\n  const nameVal = e.detail.value.split('');\r\n  itemData.value = [];\r\n  isHistory.value = true;\r\n  if (nameVal.length > 0) {\r\n    showClearIcon.value = true;\r\n    getNewData();\r\n  } else {\r\n    isHistory.value = false;\r\n    showClearIcon.value = false;\r\n  }\r\n};\r\n// 清除\r\nconst handleClear = () => {\r\n  searchData.value.keyword = '';\r\n  showClearIcon.value = false;\r\n  isHistory.value = false;\r\n  itemData.value = [];\r\n};\r\n// 清除历史记录\r\nconst clearHistory = () => {\r\n  deleteRef.value.popup.open();\r\n};\r\n// 确认删除\r\nconst subDelete = async () => {\r\n  if (searchHistoryData.value.length > 0) {\r\n    // 清空本地储存的历史数据\r\n    uni.removeStorage({\r\n      key: 'historyData',\r\n    });\r\n    searchHistoryData.value = [];\r\n    deleteRef.value.popup.close();\r\n  }\r\n};\r\n// 进入列表页\r\nconst handleList = (val) => {\r\n  // 如果是从搜索页的取消按钮进去的列表页，搜索条件设置为空\r\n  if (val === 'cancel') {\r\n    handleClear()\r\n    return\r\n  }\r\n  if (val.id) {\r\n    uni.redirectTo({\r\n    \turl: `/pages/service/components/airMaintenance?id=${val.id}`\r\n    });\r\n  }\r\n  // 手动输入的数据逻辑\r\n  if (searchData.value.keyword !== '') {\r\n    val = searchData.value.keyword;\r\n  } else {\r\n    searchData.value.keyword = val;\r\n    getNewData();\r\n    isHistory.value = true;\r\n    loading.value = true;\r\n  }\r\n};\r\n// 列表页返回列表\r\nconst handleToLink = () => {\r\n  uni.redirectTo({\r\n    url: `/pages/index/index`,\r\n  });\r\n};\r\n</script>\r\n<style src=\"./index.scss\" lang=\"scss\" scoped></style>\r\n<style lang=\"scss\">\r\n:deep(page) {\r\n  background-color: var(--neutral-color-white) !important;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/class_project/jzo2o/jzo2o-front/jzo2o-consumer/pages/search/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","onShow","getServeSearch"],"mappings":"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"}