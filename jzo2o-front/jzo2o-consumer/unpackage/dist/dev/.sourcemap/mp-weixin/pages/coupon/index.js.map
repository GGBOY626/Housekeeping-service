{"version":3,"file":"index.js","sources":["pages/coupon/index.vue","../../../../develop/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY291cG9uL2luZGV4LnZ1ZQ"],"sourcesContent":["<!--抢券列表-->\r\n<template>\r\n  <scroll-view class=\"scroll-view-content\" scroll-y>\r\n    <view class=\"pageCon appList itemListBox orderBox\">\r\n      <!-- 标题 -->\r\n      <NavBar\r\n        title=\"抢券\"\r\n        :isShowBack=\"true\"\r\n        :handleToLink=\"handleToLink\"\r\n      ></NavBar>\r\n      <!-- end -->\r\n      <view v-if=\"netStatus\">\r\n        <List\r\n          :itemData=\"itemData\"\r\n          @setTabIndex=\"setTabIndex\"\r\n          :moreStatus=\"moreStatus\"\r\n          :loading=\"loading\"\r\n          :type=\"type\"\r\n          :couponTabData=\"couponTabData\"\r\n          @addCoupons=\"addCoupons\"\r\n          @handleDelete=\"handleDelete\"\r\n          @onReachBottom=\"onReachBottom\"\r\n        ></List>\r\n      </view>\r\n      <!-- 断网显示的页面 -->\r\n      <net-fail v-else :handleToRefresh=\"handleToRefresh\"></net-fail>\r\n    </view>\r\n  </scroll-view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { onShow, onLoad } from '@dcloudio/uni-app';\r\nimport { useStore } from 'vuex';\r\n// 接口\r\nimport { getCouponList, addCoupon } from '@/pages/api/coupon.js';\r\nimport { couponTabData } from '@/utils/commonData.js';\r\n// 组件\r\n// 列表\r\nimport List from './components/list.vue';\r\n// ------定义变量------\r\nconst store = useStore(); //存储获取数据\r\nconst users = store.state.user; //获取存储数据\r\nconst typeVal = ref(users.backLink);\r\nconst deleteRef = ref(null); //定义取消弹层ref\r\nconst itemData = ref([]); //预约数据\r\nconst moreStatus = ref('more'); //加载更多状态 loading  more noMore\r\nconst netStatus = ref(true);\r\nconst loading = ref(false); // 是否展示加载更多\r\nconst orderId = ref(); //预约id\r\nconst type = ref(1);\r\n\r\nlet params = ref({\r\n  tabType: 1,\r\n});\r\nconst pages = ref(0); // 单页条数\r\nconst isSendRequest = ref(false); // 是否继续发送请求\r\nconst isback = ref(false); //是否触发了左上角返回按钮\r\n// ------定义方法------\r\nonLoad((options) => {\r\n  if (options.str) {\r\n    typeVal.value = options.str;\r\n    store.commit('user/setOrderType', false);\r\n  }\r\n  typeVal.value = users.backLink;\r\n  store.commit('user/setOrderType', false);\r\n});\r\n\r\nconst getNewData = async () => {\r\n  moreStatus.value = 'loading';\r\n  loading.value = false;\r\n  await getCouponList(params.value)\r\n    .then((res) => {\r\n      if (res.data.code == 200) {\r\n        const { data } = res.data;\r\n        itemData.value = data;\r\n        // 从第一页请求 清空之前的数据\r\n        // 下拉数据合并\r\n        // 如果 当前页面的数据已经全部数据了 那么停止拿数据\r\n        pages.value = data.length;\r\n        isSendRequest.value = true;\r\n        moreStatus.value = 'noMore';\r\n        uni.stopPullDownRefresh();\r\n        netStatus.value = true;\r\n        loading.value = true;\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      // 弹出错误提示\r\n      console.log(err);\r\n      uni.showToast({\r\n        title: err,\r\n        duration: 1000,\r\n        icon: 'none',\r\n      });\r\n      netStatus.value = false;\r\n    });\r\n};\r\n// 抢券\r\nconst addCoupons = async (id) => {\r\n  await addCoupon({\r\n    id: id,\r\n  }).then((res) => {\r\n    if (res.data.code === 200) {\r\n      uni.showToast({\r\n        title: '领取成功',\r\n        duration: 1000,\r\n        icon: 'none',\r\n      });\r\n    } else {\r\n      uni.showToast({\r\n        title: res.data.msg,\r\n        duration: 1000,\r\n        icon: 'none',\r\n      });\r\n    }\r\n  });\r\n};\r\nonShow(() => {\r\n  isSendRequest.value = false;\r\n  getNewData();\r\n});\r\n\r\n// tab触发切换\r\nconst setTabIndex = (index) => {\r\n  params.value.tabType = index;\r\n  itemData.value = []\r\n  getNewData();\r\n};\r\n// 上拉更多数据\r\nconst onReachBottom = () => {\r\n  if (pages.value < 10) {\r\n    moreStatus.value = 'noMore';\r\n    return false;\r\n  } else {\r\n    moreStatus.value = 'loading';\r\n    let times = setTimeout(() => {\r\n      getNewData();\r\n    }, 1000); //这里延时一秒在加载方法有个loading效果\r\n  }\r\n};\r\n//删除\r\nconst handleDelete = (id) => {\r\n  orderId.value = id;\r\n  deleteRef.value.popup.open();\r\n};\r\n// 列表页返回\r\nconst handleToLink = () => {\r\n  // 返回的时候需要把订单列表页的当前状态设置为0\r\n  store.commit('user/setOrderStatus', '');\r\n  // 如果是从首页进来的绑定页面，返回到首页，否则返回到绑定列表页\r\n  isback.value = true; //是否触发了左上角返回按钮\r\n  if (typeVal.value === 'my' || typeVal.value === 'pay') {\r\n    store.commit('setFootStatus', 3);\r\n    uni.redirectTo({\r\n      url: '/pages/my/index',\r\n    });\r\n  } else {\r\n    store.commit('setFootStatus', 0);\r\n    uni.reLaunch({\r\n      url: `/pages/index/index`,\r\n    });\r\n    // }\r\n  }\r\n};\r\n// 下拉刷新\r\nconst handleToRefresh = () => {\r\n  getNewData();\r\n};\r\n</script>\r\n<style src=\"./index.scss\" lang=\"scss\" scoped></style>\r\n<style lang=\"scss\" scoped>\r\n.scroll-view-content {\r\n  height: calc(100% - 81px); /* 主内容区域的高度减去底部栏的高度 */\r\n  padding-top: 259rpx; /* 底部栏的高度，确保内容不被底部栏遮挡 */\r\n  :deep(.NavBar) {\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 0;\r\n    width: 100%;\r\n    z-index: 999;\r\n  }\r\n  :deep(.itemTab .tabBox) {\r\n    box-sizing: border-box;\r\n    background: #fff !important;\r\n    position: fixed;\r\n    top: 166rpx;\r\n    width: 100%;\r\n    z-index: 999;\r\n    font-size: 28rpx;\r\n    justify-content: space-evenly;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/class_project/jzo2o/jzo2o-front/jzo2o-consumer/pages/coupon/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useStore","ref","onLoad","getCouponList","uni","addCoupon","onShow"],"mappings":"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"}