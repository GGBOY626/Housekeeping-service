{"version":3,"file":"index.js","sources":["pages/commit/index.vue","../../../../develop/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tbWl0L2luZGV4LnZ1ZQ"],"sourcesContent":["<!-- 我的评价 -->\r\n<template>\r\n  <view class=\"commit\">\r\n    <NavBar title=\"我的评价\" :isShowBack=\"true\"></NavBar>\r\n    <view v-if=\"data.length === 0\" class=\"empty-box\">\r\n      <image src=\"../../static/zwnr@2x.png\"></image>\r\n      <view>暂无评价哦～</view>\r\n    </view>\r\n    <scroll-view\r\n      v-else\r\n      scroll-y\r\n      class=\"scroll-view\"\r\n      :style=\"scrollHeight\"\r\n      lower-threshold=\"30\"\r\n      @scrolltolower=\"LoadMoreCustomers\"\r\n    >\r\n      <view class=\"cardsBox\" v-for=\"(item, index) in data\" :key=\"index\">\r\n        <view class=\"headBox\">\r\n          <view class=\"left\">\r\n            <view class=\"time\">{{\r\n              formatDateTimeToDateTimeString(\r\n                new Date(item.createTime?.replace(/-/g, '/'))\r\n              )\r\n            }}</view>\r\n            <view class=\"star\">\r\n              <uni-rate\r\n                activeColor=\"#F74145\"\r\n                color=\"#D8D8D8\"\r\n                allow-half\r\n                :disabled=\"true\"\r\n                disabledColor=\"#F74145\"\r\n                :size=\"14\"\r\n                :value=\"item.totalScore\"\r\n                margin=\"1\"\r\n              ></uni-rate>\r\n              <text>{{ item.totalScore }}分</text>\r\n            </view></view\r\n          >\r\n          <view class=\"right\">\r\n            {{ item.evaluatorInfo?.isAnonymous === 1 ? '已匿名' : '' }}\r\n          </view>\r\n        </view>\r\n\r\n        <view class=\"bodyBox\">\r\n          <text class=\"evaluationText\"> {{ item.content }}</text>\r\n          <view class=\"photoList\" v-if=\"item.pictureArray?.length > 0\">\r\n            <image\r\n              v-for=\"(img, index) in item.pictureArray\"\r\n              :key=\"index\"\r\n              :src=\"img\"\r\n              mode=\"scaleToFill\"\r\n              class=\"photo\"\r\n              @click=\"previewImage(img, item.pictureArray)\"\r\n            />\r\n          </view>\r\n          <view class=\"orderInfo\">\r\n            <view class=\"orderLeft\">\r\n              <image :src=\"item.serveItemImg\"></image>\r\n            </view>\r\n            <view class=\"orderRight\">\r\n              <view class=\"serveName\">{{ item.targetName }}</view>\r\n              <view class=\"address\">地址：{{ item.serveAddress }}</view>\r\n              <view class=\"toOrderInfo\" @click=\"toOrderInfo(item.relationId)\"\r\n                >点击查看详情></view\r\n              >\r\n            </view>\r\n          </view>\r\n          <!-- <view class=\"replay\">{{ item.replay }}</view> -->\r\n          <view class=\"footer\">\r\n            <view class=\"operation\" @click=\"openDelete(item.id)\">\r\n              删除评价\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"noMore\" v-if=\"!isSendRequest\">没有更多了</view>\r\n    </scroll-view>\r\n\r\n    <!-- 删除弹层 -->\r\n    <DeletePopup\r\n      ref=\"deleteRef\"\r\n      @handleSub=\"subDelete\"\r\n      :errorTipText=\"errorTipText\"\r\n    ></DeletePopup>\r\n    <!-- end -->\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive } from 'vue';\r\nimport { onLoad } from '@dcloudio/uni-app';\r\nimport { getCommentList, deleteComment } from '@/pages/api/order.js';\r\nimport { formatDateTimeToDateTimeString } from '@/utils/index.js';\r\n// 删除弹层\r\nimport DeletePopup from '@/components/Operate/index.vue';\r\nconst deleteRef = ref(null); //定义取消弹层ref\r\nconst errorTipText = ref({\r\n  title: '确定要删除该评价么？',\r\n  text: '确定要删除该评价么？',\r\n});\r\nlet scrollHeight = ref('');\r\nconst deleteId = ref('');\r\nconst data = ref([]);\r\nconst requestData = reactive({\r\n  pageNo: 0,\r\n  pageSize: 10,\r\n});\r\nconst isSendRequest = ref(true);\r\nonLoad(() => {\r\n  uni.getSystemInfo({\r\n    success: (res) => {\r\n      scrollHeight.value = 'height:' + (res.screenHeight - 84) + 'px';\r\n    },\r\n  });\r\n  getList();\r\n});\r\n// 获取列表\r\nconst getList = () => {\r\n  if (!isSendRequest.value) {\r\n    return;\r\n  }\r\n  requestData.pageNo = requestData.pageNo + 1;\r\n  getCommentList(requestData).then((res) => {\r\n    if (res.data.code == 200) {\r\n      data.value.push(...res.data.data);\r\n      if (res.data.data.length < requestData.pageSize) {\r\n        isSendRequest.value = false;\r\n      }\r\n    } else {\r\n      isSendRequest.value = false;\r\n    }\r\n  });\r\n};\r\n\r\n//上拉加载\r\nconst LoadMoreCustomers = () => {\r\n  getList();\r\n};\r\n// 图片放大弹层\r\nconst previewImage = (url, val) => {\r\n  uni.previewImage({\r\n    current: url,\r\n    urls: val,\r\n    success: (res) => {\r\n      console.log('success', res);\r\n    },\r\n    fail: (err) => {\r\n      console.log('fail', err);\r\n    },\r\n  });\r\n};\r\n// 删除\r\nconst subDelete = () => {\r\n  deleteComment(deleteId.value).then((res) => {\r\n    if (res.data.code == 200) {\r\n      uni.showToast({\r\n        title: '删除成功',\r\n        icon: 'none',\r\n        duration: 2000,\r\n      });\r\n      deleteRef.value.popup.close();\r\n      data.value = [];\r\n      isSendRequest.value = true;\r\n      requestData.pageNo = 0;\r\n      getList();\r\n    }\r\n  });\r\n};\r\n// 跳转到订单详情\r\nconst toOrderInfo = (val) => {\r\n  uni.navigateTo({ url: '/subPages/order/details?id=' + val });\r\n};\r\n// 打开删除弹层\r\nconst openDelete = (val) => {\r\n  deleteId.value = val;\r\n  deleteRef.value.popup.open();\r\n};\r\n</script>\r\n<style src=\"./index.scss\" scoped>\r\n/* @import url(); 引入css类 */\r\n</style>\r\n<style lang=\"less\" scoped>\r\n.noMore {\r\n  text-align: center;\r\n  padding: 10px 0;\r\n  color: #999;\r\n}\r\n.empty-box {\r\n  padding-top: 300rpx;\r\n  height: 71vh;\r\n  background-color: #fff;\r\n  image {\r\n    width: 320rpx;\r\n    height: 288rpx;\r\n    display: block;\r\n    margin: 0 auto;\r\n  }\r\n  view {\r\n    font-size: 26rpx;\r\n    line-height: 36rpx;\r\n    margin-top: 43rpx;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'D:/class_project/jzo2o/jzo2o-front/jzo2o-consumer/pages/commit/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","onLoad","uni","getCommentList","deleteComment"],"mappings":";;;;;;;;;;;;;;AA8FA,MAAM,cAAc,MAAW;;;;AAC/B,UAAM,YAAYA,cAAAA,IAAI,IAAI;AAC1B,UAAM,eAAeA,cAAAA,IAAI;AAAA,MACvB,OAAO;AAAA,MACP,MAAM;AAAA,IACR,CAAC;AACD,QAAI,eAAeA,cAAAA,IAAI,EAAE;AACzB,UAAM,WAAWA,cAAAA,IAAI,EAAE;AACvB,UAAM,OAAOA,cAAAA,IAAI,CAAA,CAAE;AACnB,UAAM,cAAcC,cAAAA,SAAS;AAAA,MAC3B,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ,CAAC;AACD,UAAM,gBAAgBD,cAAAA,IAAI,IAAI;AAC9BE,kBAAAA,OAAO,MAAM;AACXC,oBAAAA,MAAI,cAAc;AAAA,QAChB,SAAS,CAAC,QAAQ;AAChB,uBAAa,QAAQ,aAAa,IAAI,eAAe,MAAM;AAAA,QAC5D;AAAA,MACL,CAAG;AACD;IACF,CAAC;AAED,UAAM,UAAU,MAAM;AACpB,UAAI,CAAC,cAAc,OAAO;AACxB;AAAA,MACD;AACD,kBAAY,SAAS,YAAY,SAAS;AAC1CC,sBAAAA,eAAe,WAAW,EAAE,KAAK,CAAC,QAAQ;AACxC,YAAI,IAAI,KAAK,QAAQ,KAAK;AACxB,eAAK,MAAM,KAAK,GAAG,IAAI,KAAK,IAAI;AAChC,cAAI,IAAI,KAAK,KAAK,SAAS,YAAY,UAAU;AAC/C,0BAAc,QAAQ;AAAA,UACvB;AAAA,QACP,OAAW;AACL,wBAAc,QAAQ;AAAA,QACvB;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,oBAAoB,MAAM;AAC9B;IACF;AAEA,UAAM,eAAe,CAAC,KAAK,QAAQ;AACjCD,oBAAAA,MAAI,aAAa;AAAA,QACf,SAAS;AAAA,QACT,MAAM;AAAA,QACN,SAAS,CAAC,QAAQ;AAChBA,wBAAY,MAAA,MAAA,OAAA,iCAAA,WAAW,GAAG;AAAA,QAC3B;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAA,MAAA,MAAA,OAAA,iCAAY,QAAQ,GAAG;AAAA,QACxB;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,YAAY,MAAM;AACtBE,sBAAAA,cAAc,SAAS,KAAK,EAAE,KAAK,CAAC,QAAQ;AAC1C,YAAI,IAAI,KAAK,QAAQ,KAAK;AACxBF,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,YACN,UAAU;AAAA,UAClB,CAAO;AACD,oBAAU,MAAM,MAAM;AACtB,eAAK,QAAQ;AACb,wBAAc,QAAQ;AACtB,sBAAY,SAAS;AACrB;QACD;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,cAAc,CAAC,QAAQ;AAC3BA,oBAAG,MAAC,WAAW,EAAE,KAAK,gCAAgC,IAAK,CAAA;AAAA,IAC7D;AAEA,UAAM,aAAa,CAAC,QAAQ;AAC1B,eAAS,QAAQ;AACjB,gBAAU,MAAM,MAAM;IACxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KA,GAAG,WAAW,eAAe;"}